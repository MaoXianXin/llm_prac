{%- if (messages|selectattr('role', 'equalto', 'system')|list) -%}
{{ (messages|selectattr('role', 'equalto', 'system')|list|last).content|trim }}
{%- endif -%}
{%- for message in messages -%}
{%- if message['role'] == 'user' -%}
{{ message['content']|trim }}
{%- elif message['role'] == 'assistant' -%}
{{ message['content']|trim }}
{%- endif -%}
{%- endfor -%}
{%- if add_generation_prompt and messages[-1]['role'] != 'assistant' -%}
{%- endif -%}